<!DOCTYPE html>

<html>
<head>
  <title>Rethinker</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docs.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="rethinker">Rethinker</h1>
<h2 id="a-ruby-orm-for-rethinkdb">A Ruby ORM for RethinkDB</h2>
<p><a href="https://github.com/databasify/rethinker">github.com/databasify/rethinker</a></p>
<p><small>Based on <a href="https://github.com/nviennot/nobrainer">NoBrainer</a>.</small></p>
<p><a href="https://github.com/databasify/rethinker"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_white_ffffff.png" alt="Fork me on GitHub"></a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>.</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Connect to RethinkDB.<br>Connection string takes the form <code>rethinkdb://&lt;hostname&gt;/&lt;database&gt;</code>.<br>Currently, Rethinker only supports a single database.<br>In a Rails project, <code>config/initializers/rethinker.rb</code> would be a good place for this.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="constant">Rethinker</span>.connect <span class="string">'rethinkdb://localhost/blog'</span>








<span class="class"><span class="keyword">class</span> <span class="title">Post</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>To use Rethinker with a model, include <code>Rethinker::Document</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">include</span> <span class="constant">Rethinker::Document</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Specify field names, optionally providing a default value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  field <span class="symbol">:title</span>, <span class="symbol">default:</span> <span class="string">"Untitled"</span>
  field <span class="symbol">:body</span>
  field <span class="symbol">:slug</span></pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Rethinker currently supports only <code>has_many</code>/<code>belongs_to</code> relationships.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  has_many <span class="symbol">:comments</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Rethinker supports all of the <a href="http://api.rubyonrails.org/classes/ActiveModel/Validations.html">validations from Active Model</a>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  validates <span class="symbol">:body</span>, <span class="symbol">presence:</span> <span class="keyword">true</span>
  validates <span class="symbol">:title</span>, <span class="symbol">presence:</span> <span class="keyword">true</span>, <span class="symbol">length:</span> {<span class="symbol">minimum:</span> <span class="number">5</span>, <span class="symbol">maximum:</span> <span class="number">250</span>}
  validates <span class="symbol">:slug</span>, <span class="symbol">uniqueness:</span> <span class="keyword">true</span>
<span class="keyword">end</span>

<span class="class"><span class="keyword">class</span> <span class="title">Comment</span></span>
  <span class="keyword">include</span> <span class="constant">Rethinker::Document</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>You can enable the persistence of dynamic attributes by also including <code>Rethinker::Document::DynamicAttributes</code>. See below for an example.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">include</span> <span class="constant">Rethinker::Document::DynamicAttributes</span>

  field <span class="symbol">:author</span>
  field <span class="symbol">:body</span>

  belongs_to <span class="symbol">:post</span>

  validates <span class="symbol">:author</span>, <span class="symbol">:body</span>, <span class="symbol">:post</span>, <span class="symbol">:presence</span> =&gt; <span class="keyword">true</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>When using a <code>uniqueness</code> validation with one or more scopes, and referencing an association, use the association&#39;s foreign key, e.g. <code>post_id</code>, and not the association name, e.g. <code>post</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  validates <span class="symbol">:body</span>, <span class="symbol">uniqueness:</span> {<span class="symbol">scope:</span> <span class="symbol">:post_id</span>}

  after_create <span class="keyword">do</span>
    puts <span class="string">"<span class="subst">#{author}</span> commented on <span class="subst">#{post.title}</span>"</span>
  <span class="keyword">end</span>
<span class="keyword">end</span></pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>You can clear all data in the database by truncating all tables...</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="constant">Rethinker</span>.purge!</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>... or optionally dropping the whole database.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="constant">Rethinker</span>.purge!(<span class="symbol">drop:</span> <span class="keyword">true</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>Prefer <code>Model.create!</code> to <code>Model.create</code>, because <code>create!</code> will raise an exception if validations fail, whereas <code>create</code> will simply return an unsaved model object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>post = <span class="constant">Post</span>.create!(<span class="symbol">:title</span> =&gt; <span class="string">'ohai'</span>, <span class="symbol">:body</span>  =&gt; <span class="string">'yummy'</span>)

puts post.comments.create(<span class="symbol">:author</span> =&gt; <span class="string">'dude'</span>).
  errors.full_messages == [<span class="string">"Body can't be blank"</span>]

post.comments.create(<span class="symbol">:author</span> =&gt; <span class="string">'dude'</span>, <span class="symbol">:body</span> =&gt; <span class="string">'burp'</span>)
post.comments.create(<span class="symbol">:author</span> =&gt; <span class="string">'dude'</span>, <span class="symbol">:body</span> =&gt; <span class="string">'wut'</span>)
post.comments.create(<span class="symbol">:author</span> =&gt; <span class="string">'joe'</span>,  <span class="symbol">:body</span> =&gt; <span class="string">'sir'</span>)
<span class="constant">Comment</span>.all.each { |comment| puts comment.body }

post.comments.where(<span class="symbol">:author</span> =&gt; <span class="string">'dude'</span>).destroy
puts post.comments.count == <span class="number">1</span></pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Because we included <code>Rethinker::Document::DynamicAttributes</code> in the <code>Comment</code> class, we can access and update fields not defined using <code>field</code>.</p>
<p>Note that setters and getters are <em>not</em> created, so you need to access dynamic fields through <code>object[&#39;fieldname&#39;]</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>comment = post.comments.first
comment[<span class="string">'author_status'</span>] = <span class="string">'Space Cadet'</span>
comment.save

post.comments.first[<span class="string">'author_status'</span>]
 =&gt; <span class="string">'Space Cadet'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Rethinker handles regex as a condition.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>post.comments.create(<span class="symbol">:author</span> =&gt; <span class="string">'dude'</span>, <span class="symbol">:body</span> =&gt; <span class="string">'hello'</span>)
post.comments.create(<span class="symbol">:author</span> =&gt; <span class="string">'dude'</span>, <span class="symbol">:body</span> =&gt; <span class="string">'ohai'</span>)

post.comments.where(<span class="symbol">:body</span> =&gt; <span class="regexp">/^h/</span>).map{|comment| comment.body } <span class="comment"># =&gt; ["hello"]</span>
post.comments.where(<span class="symbol">:body</span> =&gt; <span class="regexp">/h/</span>).map{|comment| comment.body } <span class="comment"># =&gt; ["ohai", "hello"]</span></pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
